---
title: 好了，这下百度(google)不到了怎么办？
date: 2019-09-12 22:25:30
tags: [springboot, springCloud]
---

### 背景
突然觉得作为一名程序员要面对的东西好多啊,不仅要时刻学习日新月异新的技术栈,还要兼顾老的技术，维护项目，
这不公司技术栈的迁移变更遇到了一堆问题，不知道是不幸还是有幸，这个活落到我头上了。况且我对这个项目一点不了解，可是没有可是，
必须解决它，干。

### springCloud的引入(问题的由来)
将原有的服务改造并引入到springCloud的技术栈，这个简单，配置配好，版本对应好，将jar包的冲突解决后就没啥问题了，
由于之前都是改造的jar服务，可是这次改造的项目是web项目，也就是war包，一般是拿到tomcat里面启动的，本来改造好后，
写好Dockerfile镜像，以为可以完好运行的并部署的。可是本地可以完好的运行。但是一部署上去docker日志里面就一直报这个错误：
>tomcat start failure, fail to create bean servletEndpoint 以及一系列的堆栈信息。

有一点绝望，**本地可以启动成功但是docker里面启动却在这里报什么tomcat启动失败**，实在是郁闷，于是乎开始百度。google。

### 常规解
按惯例，拿到报错现场的看看是否包含本地项目代码的堆栈，或者什么常规配置的占位符，依赖等等的常见问题，发现没有本地项目代码的堆栈，
看了下maven树，也不是什么找不到xxx class的maven冲突的问题而且报的错误我也没见过，也不眼熟，，(开始有点慌了,都是些什么项目心里开始嘀咕)，
于是按着惯例的第二步，拿着最精确的报错信息去百度,百度不到再google，哇，各种各样有一点关联的方法等我都试验了一下，没有任何作用，怎么办？
有点绝望，都没有没有像我这样的报错，陆续拿了一些其他的错误信息，去百度，看了很多博客都没有找到一丝相关的信息。怎么办？

### 冷静解
直到我开始觉得百度google没什么意义了，索性放弃搜索了，求自己吧，由于对spring和springboot，还有springCloud的原理
和启动过程有一定的了解(跟踪过源码启动过程)，我开始自己冷静的分析看问题究竟出在哪里，
- 第一步：看项目是启动到那个地方出的问题，前面的都完成了那些操作，(能够找到注册中心，并且可以拉取配置)
- 第二步：查看问题是出在哪一步，仔细查看堆栈信息，将各个报错的信息依次排开依逐个次分析排除，分析堆栈链，按照图片排开是这样
- 第三步：直到我看到初始化一个bean的时候看他所在的包是在cloud bus里面，但是我看这个cloud bus却又没有在我们项目里面用过。于是我将这个maven包给去除了，
- 第四步: 重新发布，发现报错信息变化了，这说明确实是找到点子上了，于是再按照相同的方法又走了一遍，又排除了一个maven包，本地启动完好，部署，启动，bingo。

### 思考
虽然问题解决了，但是有一个大大问号：为什么本地可以启动而部署到docker里面使用java -jar xxx.war的方式启动却会报错呢？
我也还在继续找这个问题的答案，到时候会公布出来。通过这个案例，我们可以发现得到一些启发：springboot的项目里面没事不要乱加一些jar包
这会导致springboot 的autoConfigure自动配置一些相关的组件导致不可预测的错误，特别是但是对一个项目完全未知的时候。当然了，
出错了也大可按照我这种方式来去排除错误啦！


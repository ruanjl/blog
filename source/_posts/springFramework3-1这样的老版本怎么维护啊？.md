---
title: springFramework3.1这样的老版本怎么维护啊？
date: 2019-09-05 23:08:04
tags: [springFramework3.1, rabbitMq]
---

### 能活下来的老项目是宝
我们不可能一直是使用最新的技术，是项目总会成为过去，而项目能活下来也是不容易的,都是有他的价值的，而这个时候如果让你顶上去维护
老项目你能行么？真的，你能行么？

### 起因
最近项目先是出了一个bug，是由于技术栈的变更导致的，也就是从activeMq转变为rabbitMQ这一块。遇到了一个坑。是有关延时队列的使用，
由于rabbiMq的延时队列是使用死信队列实现的，而这个队列是一个单向阻塞队列，如果一个等待时间长的先入队，那么后面等待时间短的元素要
等到前面的元素出队列以后才能继续出队。这样会造成消息无法按时出队，于是网上搜索了下解决方案，很快就搜索到了，使用一个rabbitMq延时
插件既可以实现想要的功能。但是问题却来了

### springFramework3.1老项目
老项目的配置都是使用xml维护的，而网上的解决方案都是基于springboot的解决方案，spring Framework的解决延时队列的方案我是没有找到
于是我只好将对应配置的配置项都看了一遍，因为根本就没有对应的标签，于是我想着使用@bean 标签去注入，结果发现无法注入，因为这个spring
的版本确实是比较低的，专门上网搜索了下才看到，这个版本是刚刚出@bean这个注解的时候，这个时候的这个注解功能还处于特别低级的情况。
因为官方文档上面基本都还是在使用xml。这是我们@bean @configuration注解刚刚出道的时候。

### 无法注入
我按照官网的方法使用@bean 去注入，很多情况都无法注入，最后找到一种方法可以注入(我怀疑这个版本的@configuration注解还没什么用处)
显示需要在xml里面声明一个@bean标签 然后使用@component 注解来申明写@bean注解的这个java。而且这个不能使用@configuration这个注解
只要一使用这个注解就会找不到注入的方法。及时是这个方法我也弄了好久才找到的。因为注入的方法有点多，而我又在怀疑是不是我的方法有问题，
当我把官网的例子拿出来发现也不行的时候我就开始有着死马活马医的心态了。

### 如何依赖
虽然可以注入想要类型的bean了那么最大的一个问题来了，如何依赖呢？因为我们直接用的这个bean是没有上下文的，也就无法真正的起作用，于是我开始
使用ApplicationContext来获取上下文来获取对应的bean后注入，也是报了一堆错误，因为不能将他们一起初始化，ApplicationContext需要单独拿出来
写成静态工具类，还要保证对应的初始化顺序，这个简单，使用了个@dependOn注解即可。最后试了一把，居然真可以按着预期的运行。这个班没有白加。

### 总结
老项目的维护还是需要耐心，要懂得现在的技术封装如此高级，我们最好能使用原来的老技术也可以实现！这个确实是一个比较难得的能力！

